---
title: "Inspekt  כתיבת מערכות מאובטחות יותר. מה?"
date: 2009-02-04 13:00:06
---

אחד הדברים החשובים ביותר בעולם האינטרנט כיום, הוא האבטחה של האתר/מערכת שלכם. אבטחה כיום היא חלק גורלי אם לא מרכזי בכל אחד ואחד מחברות ההייטק כיום. אם יהיה כשל באבטחה, ולו אפילו הקטן ביותר זה יכול לסכן את כל האתר/מערכת ואפילו את השרת אשר מריץ את המערכת.

<!--more-->

ישנם עשרות דרכים לפריצה, ועשרות דרכים למנוע אותם. אחד הדרכים הנפוצות ביותר היא שימוש לרעה במשתנים הגלובאלים במערכת. ברוב האתרים כיום משתמשים ב משתנים הגלובאים כמו:

```
$_POST
$_GET
$_COOKIE
$_SERVER
```

שהם בעצם מהווים מידע כזה או אחר לגבי סביבת העבודה, השרת, התוכן שמוזן לטפסים ויוצא אל השרת וכדומה. שימוש לא נכון באחד מהמשתנים הללו יכול לסכן את כל המערכת. לכן אני התחלתי להשתמש ב <a href="http://code.google.com/p/inspekt/" target="_blank">Inspekt </a>כדי לנסות ולצמצם ואולי אפילו למנוע לחלוטין את ניסיונות הפריצה דרך המשתנים הגלובאלים במערכת.

הדרך בה פועל Inspekt הוא שהוא יוצר SuperCage ("כלוב") ומכניס לתוכו את כל המשתנים הגלובאלים אל תוך אובייקט אחד גדול. הוא תומך ב PHP 4 ו 5 ואינו דורש שום דבר נוסף כדי לעבוד איתו. הוא נוצר בהשראה ל Zend_Filter_Input אשר קיים ב <a href="framework.zend.com" target="_blank">Zend Framework</a> שנכתב על ידי Chris Shiflett.

דוגמא פשוטה לשימוש ב Inspekt

```// require the inspekt library
require "Inspekt.php";

// create a "SuperCage" to wrap all possible user input
// the SuperCage should be created before doing *anything* else
$input = Inspekt::makeSuperCage();

// we need to ensure that $_POST['userid'] is an integer
if ($userid = $input->post->testInt('userid')) {
/* do stuff with $userid */
$db->insert("id={$userid}");
} else {
trigger_error('$userid input is invalid', E_USER_ERROR);
}
```

בקוד למעלה אנחנו טוענים את הקובץ הנחוץ קודם כל. לאחר מכן יוצרים את ה"כלוב" ומגדירים את המשתנה input$ בתור האובייקט שיחזיק את הכל. לאחר מכן אנחנו מקבלים כביכול מטופס משתנה דרך טופס מסוג POST אז מחזיק את מספר המשתמש ואנחנו בודקים אם המשתנה הזה הוא אכן ערך מסוג מספרי (int) במידה וכן אנחנו נבצע משהו אחרת נציג שגיאה כלשהי. ישנם עשרות אפשרויות לבדיקה כמו אם המשתנה שהוזן הוא מסוג מספרי, סטרינג, מערך, אובייקט, כמו כן ניתן לגשת לכל אחד ואחד מהמשתנים הגלובאלים ישירות דרך המשתנה שמחזיק את כל האובייקט של הכלוב ה input$ זאת אומרת שאם ה userid היה מסוג GET היינו עושים:

```$input->get->testInt('userid')```

כנל לגבי COOKIE_$ ו SERVER_$ . כמו כן ניתן לבצע "כלוב" רק על משתנים מסויימים ולא על כל המשתנים הגלובאלים, ככה שאם צריך לגשת למשתנה גלובאלי מסויים, יהיה אפשר לעשות זאת. שימוש במחלקות כאלו או אחרות מקל ואף מייעל את כתיבת הקוד ואבטחת המערכת אותה אתם בונים. יש לזכור רק ברגע שהכלוב נוצר כל המשתנים הגלובאלים לא יהיה ניתן לגשת לערכים שלהם, ומאחר והכלוב יוצר אובייקט הכל נעשה על ידי שימוש במתודות ולא כערך (ראו דוגמא למעלה).

להמשך קריאה והסבר תוכלו להעזר <a href="http://funkatron.com/inspekt/user_docs/" target="_blank">בעמוד הבא.</a>
