---
title: "שערי מט"ח אונליין במהירות ויעילות (עודכן)"
date: 2009-02-16 23:44:55
---

כמה וכמה פעמים נשאלת השאלה כיצד אפשר להציג את שערי מטבעות החוץ ב PHP ככה שזה יהיה על בסיס שער ערך מעודכן ומהיר.

הנה דוגמא לפונקציה הכי פשוטה לקבלת המידע <a href="http://www.bankisrael.gov.il/currency.xml" target="_blank">מאתר בנק</a> ישראל ולבצע פעולה פשוטה שתציג את שער המטבע בהתאם למה שמוגדר בבנק (הבנק מעדכן את זה תמיד ואתם לא תדרשו לעשות כלום, ברגע ששער מטבע החוץ יעודכן בבנק ישראל אתם תראו את השינויים אוטומטית).

הנה הסקריפט המלא:

```
<?php

/**
* Get currency rate based on the currency
* Var passed to the function
*
* Accepted vars are dollar, euro, pound, yen
*
* @param string $currency
* @return float
*/
function GetChangeRate( $currency = 'dollar' )
{
    # Define vars used
    $xml_object = new stdClass();
    $url = 'http://www.bankisrael.gov.il/currency.xml';
    $contents = '';
    $rate = '';
    $last_update = date('d/m/Y');

    # Get xml data
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
    $contents = curl_exec ($ch);
    curl_close ($ch);

    # Create parser
    $xml_object = simplexml_load_string($contents);

    # What do we want to show?
    switch ( $currency )
    {
        case 'dollar':
            $rate = floatval($xml_object->CURRENCY[0]->RATE);
            break;

        case 'pound':
            $rate = floatval($xml_object->CURRENCY[1]->RATE);
            break;

        case 'yen':
            $rate = floatval($xml_object->CURRENCY[2]->RATE);
            break;

        case 'euro':
            $rate = floatval($xml_object->CURRENCY[3]->RATE);
            break;

        default:
            $rate = floatval($xml_object->CURRENCY[0]->RATE);
            break;
    }

    # Get last updated time
    if( $xml_object->LAST_UPDATE )
    {
        $last_update = strtolower($xml_object->LAST_UPDATE);
    }

    return array('rate' => $rate, 'last_update' => $last_update);
}

# Display
print_r(GetChangeRate('euro'));
```

מצורפת דוגמא לשימוש גם כן, כרגע הפונקציה תומכת ב דולר, אירו, ין, פאונד. ניתן כמובן להרחיב את זה לכל שאר המטבעות הנתמכות בבנק ישראל אבל את זה אני אשאיר לכל אלו שרוצים מעבר למה שמוצג למעלה. הקוד למעלה אמור לעבוד ברוב השרתים. דרושה ספריית CURL פעילה.

<strong>מה שזה יחזיר עכשיו זה מערך עם 2 אלמנטים אחד בשם rate שיחזיק את שער מטבע החוץ שבקשתם, והאלמנט השני בשם last_update יגיד מתי פעם אחרונה זה עודכן (זה יגיע ישירות מהקובץ של בנק ישראל, אז ברגע שהם יעדכנו אותו זה יתעדכן גם אצלכם אוטומטית).</strong>

אני יודע שזאת לא הדרך הטובה ביותר, גם לא היעילה ביותר אבל זה בהחלט מספק את הצרכים של אלו שרק רוצים להציג או להשתמש בשער המטבע הנכון.
